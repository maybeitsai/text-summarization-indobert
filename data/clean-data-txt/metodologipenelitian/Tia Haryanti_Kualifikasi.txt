3.1 Kerangka Umum
     Penelitian ini bertujuan untuk mengembangkan sistem deteksi dini kantuk sebelum berkendara dengan menggunakan kombinasi data visual berupa data citra wajah dan data fisiologis. Kondisi pre-driving mengacu pada kondisi sebelum pengemudi memulai perjalanan, sehingga sistem ini sangat penting untuk mencegah risiko kecelakaan di jalan. Sistem ini mengintegrasikan teknologi pengenalan wajah dan analisis data fisiologis untuk memberikan deteksi yang lebih akurat. Blok diagram secara umum yang digunakan pada penelitian ini dapat dilihat pada Gambar 3.1 Blok Diagram.
     Model ini terdiri dari tiga tahapan yaitu input, proses, dan output. Penelitian deteksi dini kantuk untuk kondisi pre-driving menggabungkan data visual yaitu pengumpulan data citra wajah pengemudi yang diambil menggunakan kamera, serta data fisiologis yang diukur berupa data EKG menggunakan perangkat wearable yaitu smartwatch dan pulse oximeter untuk mengukur saturasi oksigen (SpO2). Tahapanpre-processing dan ekstraksi fitur dilakukan pada kedua j enis data yaitu data citra gambar dan data fisiologis. Model Convolutional Neural Network (CNN) digunakan untuk mengekstraksi fitur dari data citra wajah yang merupakan data visual, sementara Long Short-Term Memory (LSTM) digunakan untuk memproses data fisiologis yang bersifat time-series. Fitur-fitur yang diekstraksi dari kedua model ini digabungkan untuk menghasilkan vector fitur gabungan. Vektor fitur ini kemudian digunakan sebagai input untuk model Support Vector Machine (SVM) yang melakukan klasifikasi akhir untuk mendeteksi kantuk. Hasil deteksi kemudian digunakan untuk memberikan peringatan kepada pengemudi layak tidak nya pengemudi untuk berkendara.

3.2 Tahapan Peneletian
     Tahapan penelitian merupakan urutan atau langkah-langkah yang dilakukan secara terstruktur dan sistematis pada penelitian ini, secara garis besar terbagi menjadi empat tahapan. Berikut adalah Gambar 3.2 Tahapan Penelitian yang dilakukan pada penelitian ini.

3.3. Pemilihan dan Persiapan Dataset
     Tahapan ini merupakan tahapan identifikasi awal dari penelitian meliputi identifikasi masalah penelitian yang berfokus pada masalah utama yaitu mendeteksi kantuk pada pengemudi menggunakan pemrosesan citra dan fisiologis. Tahapan ini dilakukan untuk memasikan bahwa hanya data yang relevan, berkualitas tinggi, dan siap untuk diproses lebih lanjut yang digunakan. Pemilihan dataset memastikan bahwa dataset yang dikumpulkan relevan dengan tujuan penelitian, yaitu hanya menggunakan data yang berkaitan dengan kondisi pre-driving, serta memastikan bahwa data visual dan data fisiologis diambil pada waktu yang sama. Tahapan pengumpulan data dan pre-processing data merupakan tahap awal untuk mempersiapkan dataset yang akan digunakan.

3.3.1 Pengumpulan Data
     Data dibagi menjadi dua kategori utama yaitu data primer dan data sekunder. Data primer diperoleh berdasarkan pengumpulan dan pengamatan langsung oleh peneliti berdasarkan kondisi subjek penelitian dan rekaman aktivitas fisik atau ekspresi wajah menggunakan kamera, serta pengukuran fisiologis yang menggunakan perangkat wearable. Data primer ini berupa data objektif dengan mengumpulkan data citra wajah dan pengukuran fisiologis. Berikut merupakan Gambar 3.3 Pengumpulan Data.

     Dataset visual berupa citra wajah yang berfokus pada wajah pengemudi yang diambil menggunakan kamera dengan spesifikasi 12 MP. Data visual dan fisiologis berupa data yang diambil dari partisipan dalam kondisi terjaga dan mengantuk. Data fisiologis mencakup pengukuran langsung dari respons tubuh berupa sinyal EKG (Elektrokardiogram) yang merekam detak jantung (HR), variabilitas detak jantung atau Heart Rate Variability (HRV) menggunakan perangkat wearable dan pengukuran saturasi oksigen dalam darah (SpO2) yang diukur menggunakan pulse oximeter.

3.3.2 Pre-Processing Data
      Melakukan analisis eksploratif data untuk memahami karakteristik dataset sehingga meningkatkan kualitas deteksi. Pre-Processing yang dilakukan yaitupreprocessing citra dan pre-processing data fisiologis. Pre-processing citra yaitu dengan mendeteksi wajah dan mata, normalisasi pencahayaan, pemotongan area wajah yang relevan. Ektraksi frame dari video menggunakan OpenCV. Preprocessing data fisiologis yaitu dengan normalisasi data, dan segmentasi. Berikut merupakan Gambar 3.4 Pre-Processing Data.

      Dataset yang dikumpulkan kemudian diolah, yang meliputi normalisasi, 
penghilangan noise, dan teknik pra-pemrosesan lainnya untuk membuat data siap 
digunakan dalam ekstraksi fitur. Langkah ini melibatkan pembersihan dan penyiapan data 
untuk analisis.
      Proses pre-processing untuk data visual atau data gambar, yaitu:
1. Pengumpulan data visual dengan mengambil gambar wajah pengemudi menggunakan kamera berfokus pada mata.
2. Deteksi wajah dan deteksi mata, menggunakan algoritma deteksi wajah seperti Haar Cascades atau Dlib untuk mendetekasi dan melokalisasi wajah dalam gambar.
3. Deteksi mata, yaitu mendeteksi mata da;am area wajah yang terdeteksi.
4. Ekstraksi ROI (Region of Interest) dengan mengambil area mata dari gambar.
5. Teknik normalisasi untuk mengubah ukuran gambar mata menjadi dimensi yang konsisten missal nya 64x64 pixel, serta menormalisasi nilai pixel gambar dalam rentang [0, 1] atau [-1, 1].
6. Augmentasi gambar dilakukan untuk meningkatkan variasi data, seperti rotasi, flipping horizontal atau vertikal, zooming, dan perubahan cahaya
7. Penyimpanan data yang diproses dengan menyimpan gambar yang telah diproses dan fitur yang diekstraski dalam format terstruktur (CSV atau database).
Proses pre-processing untuk data fisiologis yaitu:
1. Pengumpulan data fisiologis menggunakan wearable untuk merekam detak jantung (HR), variabilitas detak jantung (HRV), dan saturasi oksigen (SpO2).
2. Pembersihan data dengan menghilangkan noise dengan menggunakan teknik filtering, dan imputasi data hilang dengan mengisi data yang hilang menggunakan metode seperti mean, median, atau interpolasi.
3. Normalisasi data dengan Min-Max sehingga menyesuaikan dengan skala data ke rentang yang konsisten [0, 1].
4. Segmentasi data dilakukan dengan membagi data menjadi segmen dengan ukuran waktu tetap (yaitu 30 detik).
5. Normalisasi data untuk memastikan konsistensi skala antar subjek dan pengukuran.
6. Penyimpanan data yang diproses yaitu data fisiologis dalam format terstruktur.
     Langkah selanjutnya yaitu sinkronisasi data dengan menggabungkan data visual serta data fisiologis berdasarkan timestamp. Selanjutnya memastikan bahwa data visual dan fisiologis yang telah disinkronkan mencerminkan kondisi yang sama pada waktu yang sama. Selanjutnya yaitu menyimpan data yang telah disinkronkan dalam format yang mudah diakses untuk dianalisis lebih lanjut.

3.4. Pembuatan Model
     Pembuatan model merupakan proses implementasi dari desain arsitektur yang telah direncanakan. Langkah dari pembuatan model yaitu penulisan kode untuk membangun model sesuai dengan desain arsitektur yaitu CNN, LSTM, dan SVM. Selanjutnya, mengonfigurasi model dengan optimizer, fungsi loss, dan metrik evaluasi. Kemudian melakukan pelatihan model menggunakan dataset yang telah dibagi menjadi training set dan validation set pada tahapan pre-processing. Selanjutnya dilakukan validasi serta tuning hyperparameters untuk mengoptimalkan kinerja model.

3.4.1	Ekstraksi Fitur
     Ekstraksi fitur dilakukan untuk menangkap karakteristik penting dari data yang telah diproses. Fitur ini akan digunakan sebagai input untuk model pembelajaran mesin. Ektraksi fitur dilakukan pada data visual berupa data gambar, dan data fisiologis.
1. Data Visual
a. Eye Aspect Ratio (EAR), digunakan untuk mendeteksi apakah mata terbuka atau tertutup.
b. Pupil Dilation, digunakan untuk mengukur perubahan ukuran pupil.
c. Redness of Eyes, mengukur tingkat kemerahan pada mata.
d. Eye Openess, mengukur bukaan mata berdasarkan jarak vertikal antara kelopak mata atas dan bawah.
2. Data Fisiologis
a. Heart Rate (HR), mengukur detak jantung per menit.
b. Heart Rate Variability (HRV), mengukur variabilitas detak jantung.
c. Respiratory Rate (RR), mengukur laju pernapasan.
d. SpO2, saturasi oksigen dalam darah
     Ekstraksi fitur dengan Convolutional Neural Network (CNN) adalah proses yang menggunakan lapisan konvolusi dan pooling untuk menangkap fitur penting dari data gambar. Langkah-langkah ekstraksi fitur dengan CNN:
1. Convolutional Layer: Menggunakan filter untuk menangkap fitur spasial dari gambar. 
2. Pooling Layer: Mengurangi dimensi peta fitur sambil mempertahankan fitur penting.
3. Fully Connected Layer: Menghubungkan peta fitur yang telah diratakan untuk melakukan klasifikasi atau ekstraksi fitur.
4. Pelatihan Model: Menyesuaikan bobot filter melalui backpropagation dengan data latih.
5. Ekstraksi Fitur: Menggunakan model yang telah dilatih untuk mengekstraksi fitur dari gambar baru.
      Ekstraksi fitur dengan Long Short-Term Memory (LSTM) adalah proses yang menggunakan jaringan LSTM untuk menangkap pola temporal dan hubungan jangka panjang dalam data sekuensial, seperti data fisiologis (EKG, HR, HRV, RR, dan SpO2). LSTM sangat efektif dalam menangani data yang memiliki ketergantungan waktu. Ekstraksi fitur dengan LSTM melibatkan beberapa langkah penting:
1. Menyiapkan Data: Menyiapkan data sekuensial dalam bentuk yang sesuai untuk input ke LSTM.
2. Membangun Model LSTM: Membangun model LSTM dengan lapisan LSTM dan Dense untuk ekstraksi fitur.
3. Melatih Model LSTM: Melatih model menggunakan data sekuensial untuk menyesuaikan bobot jaringan.
4. Ekstraksi Fitur: Menggunakan model yang telah dilatih untuk mengekstraksi fitur dari data sekuensial baru.

3.4.2 Penggabungan Fitur
      Fitur-fitur yang telah diekstraksi dari ekstraksi fitur dengan model CNN yaitu dari gambar visul dengan mengekstraksi bagian mata dan ektraksi fitur dari data sekuensial dengan menggunakan LSTM berupa data fisiologis. Selanjutnya, penggabungan fitur visual dan fitur sekuensial menggunakan metode penggabungan (concatenation) digabungkan membentuk satu set fitur komprehensif yang akan digunakan untuk pelatihan model yaitu klasifikasi akhir menggunakan model SVM.

3.4.3 Pemisahan Dataset
      Pembagian dataset merupakan langkah penting dalam proses pelatihan dan evaluasi model. Merujuk pada penelitian (Li, K., Gong, Y., & Ren, Z., 2020) untuk pembagian dataset dibagi menjadi tiga bagian yaitu training set (40%), validation set (10%), dan test set (50%), namun pada penelitian ini pembagian dataset yang terdiri dari data gambar dan data fisiologis dibagi menjadi berikut:
1. Training Set (75%), data yang digunakan untuk melatih melatih model.
2. Validation Set (15%), digunakan untuk tuning hyperparameters dan memilih model terbaik.
3. Test Set (15%), digunakan untuk mengevaluasi kinerja akhir model.

3.4.4 Desain Arsitektur
      Desain arsitektur merupakan proses menentukan struktur dan komponen model yang akan dibangun, yang terdiri dari jenis model, jumlah dan jenis layer, fungsi aktivasi, teknik regularisasi, dan konfigurasi model. Jenis model penelitian ini melibatkan dua model utama yaitu Convolutional Neural Network (CNN) untuk data visual dan Long Short-Term Memory (LSTM) untuk data fisiologis. Hasil dari kedua model digabungkan dan diklasifikasikan menggunakan Support Vector Machine (SVM). Model ini terdiri dari tiga tahapan yaitu akuisisi data, preprocessing data, ekstraksi fitur, penggabungan fitur, dan klasifikasi dengan SVM, dan output sistem. Berikut merupakan Gambar 3.5 Arsitektur Model.

      Tahap ini mencakup perancangan arsitektur CNN yang akan digunakan, termasuk pemilihan jumlah dan jenis layer, fungsi aktivasi, dan teknik regularisasi. Digunakan untuk mengolah data visual, seperti mengenali mata tertutup atau mulut menguap sebagai indikator kantuk. LSTM digunakan untuk menganalisis data fisiologis yang berurutan, seperti pola detak jantung yang menunjukkan kelelahan atau penurunan kewaspadaan. Menggabungkan fitur yang diekstrak dari CNN dan LSTM untuk mendapatkan representasi data yang komprehensif, memastikan bahwa model dapat mengidentifikasi kantuk berdasarkan kombinasi indikator visual dan fisiologis. Selanjutnya yaitu menggunakan Support Vector Machines (SVM) untuk mengklasifikasikan data sebagai "kantuk" atau "tidak kantuk". SVM dipilih karena kemampuannya dalam mengklasifikasikan data yang kompleks dan memberikan batas keputusan yang jelas "layak" atau "tidak layak" pengemudi untuk berkendara. Jika pengklasifikasi mendeteksi keadaan mengantuk, maka pengklasifikasi menghasilkan alarm atau notifikasi pemberitahuan untuk memberi tahu bahwa pengemudi tidak layak untuk berkendara atau kembali ke fase pertama dan memulai ulang prosedur.

3.4.5 Pelatihan Model dengan Dataset
     Pelatihan model dilakukan dengan menggunakan training set, dengan tuning hyperparamaters berdasarkan kinerja pada validation set. Pelatihan model dilakukan dengan model SVM menggunakan training set.

3.5 Evaluasi
     Model gabungan ini dievaluasi menggunakan metrik seperti akurasi, presisi, recall, dan F1-score untuk memastikan performa dan keandalannya. Implementasi sistem ini diharapkan dapat memberikan notifikasi atau peringatan kepada pengemudi jika tanda-tanda kantuk terdeteksi selama kondisi pre-driving, sehingga dapat meningkatkan keselamatan berkendara secara signifikan. Berdasarkan hasil validasi, model dapat di-tune atau dioptimalkan untuk meningkatkan performa, misalnya dengan mengubah arsitektur, parameter, atau teknik training.

3.6 Implementasi
     Setelah penyempurnaan, model dianggap siap untuk digunakan. Model ini harus dapat secara akurat mendeteksi kantuk pengemudi dalam berbagai kondisi dengan minimal kesalahan. Langkah selanjutnya yaitu penerapan model dalam sistem nyata dan pemantauan efektivitasnya dalam kondisi pengemudi pada lingkungan pre-driving. Model yang telah dioptimalkan diintegrasikan ke dalam sistem deteksi dini kantuk untuk pengujian awal. Selanjutnya yaitu melakukan uji coba lapangan untuk mengevaluasi efektivitas sistem dalam kondisi nyata, memungkinkan pengumpulan feedback untuk perbaikan lebih lanjut.